---
title: "Trump's Victory? Predicting the 2020 Presidential Election Using Logistic Regression and Post-stratification"
author: "Jiaheng Li, Yuechen Shen, Yuxin Yang"
date: "27/10/2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(tidyverse)
library(visdat)
library(kableExtra)

# Loading in the cleaned survey Data
survey_data <- read_csv("/Users/yangyuxin/Downloads/UofT 2018-2022/Academic/STA304/STA304_PS3/survey_data.csv")

# Loading in the cleaned census Data
census_data <- read_csv("/Users/yangyuxin/Downloads/UofT 2018-2022/Academic/STA304/STA304_PS3/census_data.csv") %>%
  na.omit()
```




*Code and data supporting this analysis is available at: *
https://github.com/yangyu77/STA304_PS3.git



Who will win the election? Trump or Biden? As the U.S. presidential election day approaches, many people are increasingly concerning about the election results. We are interested in seeing if Dodald Trump would win the 2020 re-election race with Democrat Joe Biden, thus we choose to use a regression model to predict the popular vote outcome of the 2020 U.S. election based on the Democracy Fund + UCLA Nationscape data and the American Community Surveys (ACS) data. 

# Overview: Data Sets After Data Cleaning

**The Democracy Fund + UCLA Nationscape data (`survey_data`):**

*Tausanovitch, Chris and Lynn Vavreck. 2020. Democracy Fund + UCLA Nationscape, October 10-17, 2019 (version 20200814). Retrieved from [https://www.voterstudygroup.org/downloads?key=ae440528-c8e4-488f-a153-58e9244de17e].*
```{r, echo=FALSE}
kbl(head(survey_data), booktabs = T)
```
The Democracy Fund + UCLA Nationscape data set was collected from a public opinion survey project. The original data set contains variables for the political news sources, the political views, the vote choice for 2016 election, the basic demographic information, the employment status, and the state each respondent lives in. Note that the original data set does not contain any observations from the District of Clumbia.

We pick the gender, the age, the race, the employment status, and the state as the predictor variables, and "whether vote for Trump" as well as "whether vote for Biden" as the response variables to build models. The cleaned data set `survey_data` contains 6,445 observations (rows) in total. We note that the original Nationscape data set also includes the vote choice for 2016 election, which could be a good predictor for the current election voting. However, we will not include this variable in the models, because the ACS data set does not include vote choice variable while we need the two data sets to match exactly for model prediction. 

\newpage

**The 2018 American Community Surveys (`census_data`):**

*Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer, Jose Pacas and Matthew Sobek. IPUMS USA: Version 10.0 [dataset]. Minneapolis, MN: IPUMS, 2020. https://doi.org/10.18128/D010.V10.0*
```{r, echo=FALSE}
kbl(head(census_data), booktabs = T) 
```
The original ACS data set contains a comprehensive set of variables for demographic information, including age, sex, race, employment status, educational attainment, and the name of the state. It also incudes information in household level. The raw data set contains 3,214,539 observations, thus it is representative for the entire U.S. population. 

In order to make prediction using the fitted model, we need to pick variables that match the predictor variables in the model. Therefore, we pick the equivalent predictor variables as the `survey_data`, which are the gender, age, race, employment status, and the state name. We modify the categories for some variables to get an exact match of variables from the two data sets. We also exclude respondents aged less than 16, because they are ineligible for voting up until 2020. 

The cleaned data set `census_data` is already post-stratified. The column variable `n` represents the number of respondents within the same group of state, gender, age, race, and employment status. The details of poststratification will be discussed later.





# Model and Specifications

We are interested in predicting the popular vote outcome of the 2020 American federal election (include citation). To do this we will first build *two* binary logistic regression models based on the Democracy Fund + UCLA Nationscape data (the `survey_data`), and apply the fitted models to the ACS data set (the `census_data`) to make predictions for proportion of voters who advocate Donald Trump/Biden, in another words, the probability of Trump/Biden wining the election. We will also utilize a post-stratification technique to account for any under-represented groups in the Nationscape data set. In the following sub-sections I will describe the model specifics and the post-stratification calculation.

We use the binary logistic regression model, because our response variable `vote_trump` is binary, representing whether or not the respondent will vote for Trump. It is exactly the model to be used when the dependent variable is binary (0/1, True/False, Yes/No). Moreover, the logistic regression is a classification algorithm which enable us to find the probability of event to be a success or a failure. It supports categorizing data into discrete classes by studying the relationship from a given set of labelled data.[1] 


## Model Specifics

For the explanatory variables, we will be using age, which is recorded as a numeric variable, and gender, race, employment status, states as categorical variables to model the probability of voters voting for Donald Trump or Joe Biden. 

**The five predictor variables are:**

$x_{age}$: a numeric variable, representing the age of the respondent.

$x_{gender}$: the gender identity of the respondent in the Nationscape survey study, which is either male or female.

$x_{race\_ethnicity}$: the single race that the respondent belongs to in terms of anthropological concept. This variable has 6 categories:

1. White; 
2. Black or African American; 
3. American Indian or Alaska Native;
4. East Asian;
5. Other Asian or Pacific Islander;
6. Other.

$x_{employment}$: the employment status of the respondent. This variable has 5 categories:

1. Employed; 
2. Unemployed; 
3. Not in labor force;
4. Student;
5. Other.
P.S. Homemaker, retired people, and disabled individuals are categorized as "not in labor force".

$x_{state\_name}$: the state that the respondent live in. This variable includes all US states except the District of Colombia and Puerto Rico.


**The logistic regression models we are using are:**

+ Donald Trump:
$$ y_{vote\_trump} = \beta_0  + \beta_1 X_{male} + \beta_2 X_{age} + \beta_3 X_{Black or African American} + \beta_4 X_{East Asian} + \beta_5 X_{raceOther} + $$ 
$$ \beta_6 X_{Other Asian or Pacific Islander} + \beta_7 X_{White} + \beta_8 X_{NotInLaborForce} + \beta_9 X_{employmentOther} + \beta_{10} X_{Student} +$$
$$\beta_{11} X_{Unemployed} + \beta_{12} X_{Alaska} + \beta_{13} X_{Arizona} + \beta_{14} X_{Arkansas} + \beta_{15} X_{California} + \beta_{16} X_{Colorado} + $$
$$\beta_{17} X_{Connecticut} + \beta_{18} X_{Delaware} + \beta_{19} X_{Florida} + \beta_{20} X_{Georgia} + \beta_{21} X_{Hawaii} +  \beta_{22} X_{Idaho} + \beta_{23} X_{Illinois} +$$ 
$$ \beta_{24} X_{Indiana} + \beta_{25} X_{Iowa} + \beta_{26} X_{Kansas} + \beta_{27} X_{Kentucky} + \beta_{28} X_{Louisiana} + \beta_{29} X_{Maine} +$$ 
$$ \beta_{30} X_{Maryland} + \beta_{31} X_{Massachusetts} + \beta_{32} X_{Michigan} + \beta_{33} X_{Minnesota} + \beta_{34} X_{Mississippi} + \beta_{35} X_{Missouri} +$$ 
$$ \beta_{36} X_{Montana} + \beta_{37} X_{Nebraska} +\beta_{38} X_{Nevada} +\beta_{39} X_{New Hampshire} +  \beta_{40} X_{New Jersey} + \beta_{41} X_{New Mexico} + $$ 
$$ \beta_{42} X_{New York} + \beta_{43} X_{North Carolina} + \beta_{44} X_{North Dakota} + beta_{45} X_{Ohio} + \beta_{46} x_{Oklahoma} + \beta_{47} X_{Oregon} +$$ 
$$\beta_{48} X_{Pennsylvania} + \beta_{49} X_{Rhode Island} + \beta_{50} X_{South Carolina} + \beta_{51} X_{South Dakota} + \beta_{52} X_{Tennessee} + \beta_{53} x_{Texas} +$$ 
$$\beta_{54} X_{Utah} + \beta_{55} X_{Vermont} + \beta_{56} X_{Virginia} + \beta_{57} X_{Washington} + \beta_{58} X_{West Virginia} + \beta_{59} X_{Wisconsin} + \beta_{60} X_{Wyoming} + \epsilon$$ 


Where $y$ represents the probability of voters to vote for Donald Trump in the 2020 U.S. Presidential Election. $vote\_trump=1$ denotes "will vote for Trump", while $vote\_trump=0$ denotes "will not vote for Trump".

$\beta_0$ represents the intercept of the model. 

$\beta_1$ represents the relationship between whether vote for Trump and the voter's gender. For every male voter, we expect a $\beta_1$ increase in the probability of voting for Donald Trump.

$\beta_2$ represents the slope of the model. So, for everyone one unit increase in age, we expect a $\beta_2$ increase in the probability of voting for Donald Trump.

$\beta_3$ to $\beta_6$ represents the relationship between whether vote for Trump and the voter as different race (Black or African American, white, East Asian, Other Asian or Pacific Islander,  Other)

$\beta_7$ to $\beta_{10}$ represents the relationship between whether vote for Trump and the voter as different employment statuses (not in labor force, not employment,student, Other)

$\beta_{11}$ to $\beta_{60}$ represents the relationship between whether vote for Trump and the different states the voters live in, when all other predictors hold as the same.


+ Joe Biden:

The model is the same as the model for Trump, except that the response variable is `vote\_biden`,
where $y$ represents the probability of voters to vote for Joe Biden in the 2020 U.S. Presidential Election. $vote\_biden=1$ denotes "will vote for Biden", while $vote\_trump=0$ denotes "will not vote for Biden".


## Model Fitting

+ Donald Trump

```{r}
# Create the Model
model_logit_trump <- glm(vote_trump ~ gender + age + race_ethnicity + employment + 
                           state_name, data = survey_data, binomial)

# Model Summary (to be reported in Results section)
kable(broom::tidy(model_logit_trump), "latex", booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down"))
```

```{r}
# Apply the fitted model to census_data, and get the log odds estimates
census_data$logodds_estimate <- model_logit_trump%>%
  predict(newdata = census_data)

# Calculate the probability of voting for Trump for individuals within each stratum
census_data$estimate <- exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

# Sum up the probability of voting for Trump for each stratum
census_data <- census_data %>%
  mutate(elect_predict_prob = estimate * n) 
```

```{r}
Trump_prob <- sum(census_data$elect_predict_prob)/sum(census_data$n)
Trump_prob
```


+ Joe Biden

```{r}
# Creating the Model
model_logit_biden <- glm(vote_biden ~ gender + age + race_ethnicity + employment + 
                           state_name, data = survey_data, binomial)

# Model Results (to Report in Results section)
kable(broom::tidy(model_logit_biden), "latex", booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down"))
```

```{r}
# Apply the fitted model to census_data, and get the log odds estimates
census_data$logodds_estimate2 <- model_logit_biden%>%
  predict(newdata = census_data)

# Calculate the probability of voting for Biden for individuals within each stratum
census_data$estimate2 <- exp(census_data$logodds_estimate2)/(1+exp(census_data$logodds_estimate2))

# Sum up the probability of voting for Biden for each stratum
census_data <- census_data %>%
  mutate(elect_predict_prob2 = estimate2 * n) 
```

```{r}
Biden_prob <- sum(census_data$elect_predict_prob2)/sum(census_data$n)
Biden_prob
```

```{r}
polling <- census_data%>%
  group_by(state_name) %>%
  mutate(state_poll_trump = sum(elect_predict_prob)/sum(n)) %>%
  mutate(state_poll_biden = sum(elect_predict_prob2)/sum(n)) %>%
  dplyr::select(state_name, state_poll_trump, state_poll_biden) %>%
  distinct() %>%
  mutate(trump_victory = ifelse(state_poll_trump > state_poll_biden, 1, 0)) %>%
  mutate(biden_victory = ifelse(state_poll_biden > state_poll_trump, 1, 0))

polling$num_votes <- c(9, 3, 11, 6, 55, 9, 7, 3, 29, 16, 4, 4, 20, 11, 6, 6, 8, 8, 4, 10, 11, 16, 10, 6, 10, 3, 5, 6, 4, 14, 5, 29, 15, 3, 18, 7, 7, 20, 4, 9, 3, 11, 38, 6, 3, 13, 12, 5, 10, 3)

# View(polling)
```

```{r}
sum(polling$trump_victory * polling$num_votes)
sum(polling$biden_victory * polling$num_votes)
```


